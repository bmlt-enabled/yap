"use strict";(self.webpackChunkyapdocs=self.webpackChunkyapdocs||[]).push([[563],{3905:function(e,t,r){r.d(t,{Zo:function(){return p},kt:function(){return h}});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var s=n.createContext({}),c=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=c(r),h=o,d=m["".concat(s,".").concat(h)]||m[h]||u[h]||a;return r?n.createElement(d,i(i({ref:t},p),{},{components:r})):n.createElement(d,i({ref:t},p))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<a;c++)i[c]=r[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},8734:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},assets:function(){return p},toc:function(){return u},default:function(){return h}});var n=r(7462),o=r(3366),a=(r(7294),r(3905)),i=["components"],l={slug:"merging-yap-post",title:"Merging Yap Servers",authors:["fortysevenbot"],tags:["yap"]},s="Merging a Regional Yap Server into a Zonal Yap Server",c={permalink:"/blog/merging-yap-post",editUrl:"https://github.com/bmlt-enabled/yap/edit/docs/blog/2021-08-01-merging-yap-post/index.md",source:"@site/blog/2021-08-01-merging-yap-post/index.md",title:"Merging Yap Servers",description:"Since Yap 3.0.0 (released in March 2019), it\u2019s been possible to use a single Yap server with multiple Twilio accounts.  What this means is that a service body can handle the overhead of server management while another service body retains the management of phone numbers and billing.",date:"2021-08-01T00:00:00.000Z",formattedDate:"August 1, 2021",tags:[{label:"yap",permalink:"/blog/tags/yap"}],readingTime:2.01,truncated:!0,authors:[{name:"FortySeven Bot",title:"BMLT Bot",url:"https://github.com/fortysevenbot",imageURL:"https://github.com/fortysevenbot.png",key:"fortysevenbot"}],nextItem:{title:"Excluding a custom format from a Yap query",permalink:"/blog/excluding-format-post"}},p={authorsImageUrls:[void 0]},u=[],m={toc:u};function h(e){var t=e.components,l=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,n.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Since Yap 3.0.0 (released in March 2019), it\u2019s been possible to use a single Yap server with multiple Twilio accounts.  What this means is that a service body can handle the overhead of server management while another service body retains the management of phone numbers and billing."),(0,a.kt)("p",null,"Yap 3 also introduced the concept of configuration precedence ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/bmlt-enabled/yap/wiki/Configuration-Precedence"},"https://github.com/bmlt-enabled/yap/wiki/Configuration-Precedence"),".  This creates the ability to manifest all kinds of powerful capability without requiring access to the config.php on the server (critical for this situation where server management is handled by someone else).  It also has the ability to set a value at regional level while the hierarchy of the BMLT automatically cascades down to the member areas."),(0,a.kt)("p",null,"Recently I had to migrate my regional yap server to the zonal server.  Below is the process I followed, feel free to send an email to ",(0,a.kt)("a",{parentName:"p",href:"mailto:help@bmlt.app"},"help@bmlt.app")," if you\u2019d like more details."),(0,a.kt)("p",null,"Consider whether you may want to take a backup and overwrite your existing Yap database, or make a copy with a new install and config to do side by side testing.  You may also want to consider setting in the database config ahead of time or afterward.  You may also want to transfer any other settings in your top level config.php to the Config settings in the admin portal.  Keep in mind that service bodies will use the hierarchy, so if you set this as a regional level all the service bodies connected will inherit them."),(0,a.kt)("p",null,"1) Delete any configuration from the target yap server, use the server body IDs that would be the IDs that would be the query below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM config where service_body_id in (x [,x]);\n")),(0,a.kt)("p",null,"2) Begin an export from your source yap server, select only data and exclude the flags table.  See the screenshot below.  (Use a self-contained file)"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"MySQL Export",src:r(4962).Z})),(0,a.kt)("p",null,"3) After the file has been exported run the below on your system.  In the below example, \u201cexport.sql\u201d is the file exported from Step 2 above."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cat export.sql | sed -e \u201cs/([0-9]*,/(NULL,/g\u201d > export-mod.sql\n")),(0,a.kt)("p",null,"4) Import export-mod.sql into the target yap server.  \u201cexport-mod.sql\u201d is the output from the command run locally in Step 3 above."),(0,a.kt)("p",null,"5) Your phone numbers must have explicit service body overrides in order to pull configuration values from the database (you can use either override_service_body_id or override_service_body_config_id).  One changes your service body for call routing and the other selects configuration, respectively."))}h.isMDXComponent=!0},4962:function(e,t,r){t.Z=r.p+"assets/images/mysql-export-e5f71a6ce1c368a20c842f3ab6a8bca5.png"}}]);